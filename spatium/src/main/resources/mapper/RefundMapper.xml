<?xml version="1.0" encoding="UTF-8"?>	
<!DOCTYPE mapper	
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"	
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">	
<mapper namespace="com.urban.spatium.mapper.RefundMapper">	
	
	<update id="refundRsv" parameterType="Rsv">
	UPDATE 
		tbRsv
	SET
		rsvState= #{rsvState}
	WHERE 
		rsvCode = #{rsvCode}
	</update>
	
	<update id="refundPayment" parameterType="Payment">
		UPDATE 
			tbPayment
		SET
			paymentRefund=#{paymentRefund}
		WHERE 
			paymentRsvCode=#{paymentRsvCode}
	</update>
	
	
	<insert id="refundAddPoint" parameterType="Point">
	INSERT INTO tbPointList
		(
		 pointID
		, pointAddList
		, pointSellList
		, pointList
		, pointPaymentCode
		, pointModyfiDate
		)
		VALUES 
		(
		#{pointID}
		, #{pointAddList}
		, #{pointSellList}
		, #{pointList}
		, #{pointPaymentCode}
		, NOW()
		)
	</insert>
	
	<insert id="cancelRefund" parameterType="CancelRsv" >
	INSERT INTO tbCancelRsv
		(
		cancelRsvCode
		, cancelUserId
		, cancelState
		, cancelReason
		, cancelPrice
		, refundPolicyCode
		, cancelRegDate
		, cancelConfirmDate
		)
	VALUES 
	(	
		#{cancelRsvCode}
		, #{cancelUserId}
		, #{cancelState}
		, #{cancelReason}
		, #{cancelPrice}
		, #{refundPolicyCode}
		, NOW()
		, NOW()
	)
	</insert>
	
	
	<insert id="addRefundPolicy" parameterType="java.util.Map">	
     INSERT INTO tbRefundPolicy	
		( refundPolicyStoreCode	
		, remainingDay	
		, refundPercent	
		, refundPolicyUserId	
		, refundPolicyRegDate)	
      VALUES	
       <foreach collection="list" item="i" separator=" , "> 	
       (	
        #{i.refundPolicyStoreCode}	
      , #{i.remainingDay}	
      , #{i.refundPercent}	
      , #{i.refundPolicyUserId}	
      , NOW()	
      )	
      </foreach>	
   </insert>	
   <select id="getRefundPolicy" parameterType="int" resultType="RefundPolicy">
   		SELECT 
			refundPolicyCode
			, refundPolicyStoreCode
			, remainingDay
			, refundPercent
			, refundPolicyUserId
		FROM tbRefundPolicy
			WHERE refundPolicyStoreCode = #{storeCode}
		ORDER BY remainingDay DESC;
   </select>	

</mapper> 